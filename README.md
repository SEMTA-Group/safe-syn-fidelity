# safe-syn-fidelity
safety-aware fidelity calibration of synthetic data generators

### A. Licensing

#### Code
The source code in this repository is distributed under the Apache License 2.0. See the [LICENSE](./LICENSE) file for the full license text.

#### Data
The KITTI data included in this repository is subject to its original license terms. The KITTI dataset is used in accordance with its license, and details can be found in the [DATA_LICENSE.txt](./DATA_LICENSE.txt) file. Users are responsible for adhering to the KITTI license terms when using this data.

### B. Quick start

Run one of the jupyter notebooks with names started with "RQ", in order to replicate the experiment. 

### C. Folder structure

* [data/data_real/](data/data_real/) for the real data prepared following KITTI format, to be read by Pytorch
* [data/data_syn_Carla/](data/data_syn_Carla/) for the synthetic data style transferred into Carla, prepared following KITTI format, to be read by Pytorch
* [data/data_syn_DALLE3/](data/data_syn_DALLE3/) for the synthetic data generated by DALLE3, manually trunked and labelled, to be read by Pytorch

### D. Instructions to synthesize image using ChatGPT and DALLE3

For images manually generated from ChatGPT and DALLE3, we need to perform some manual work to label it and to change the format.

Step 1: Use ChatGPT 4.0 and follow the prompt [DALLE_Prompts.txt](DALLE_Prompts.txt) to feed a KITTI image, ask for scene interpretation, and finally, create a similar image.

Step 2: Download the image and store it somewhere. 

Step 3: Trim the image such that it has a dimension of 1242x375, and store it into [data/KITTI_Syn_DALLE3_Resize](data/KITTI_Syn_DALLE3_Resize). 

The PNG image generated by DALLE3 is with four channels (RGBA). To allow the object detector to read it, one shall convert it into a 3-channel image (RGB). 
* Images in [data/data_syn_DALLE3/Kitti/raw/training/image_2](data/data_syn_DALLE3/Kitti/raw/training/image_2) are already translated with RGB.
* To perform translation, one can trigger [util.ipynb](util.ipynb)

Step 4: Trigger [LabelImg](https://pypi.org/project/labelImg/1.4.0/) to perform manual labelling

Note: LabelImg has compatibility issues with python 3.10, follow this [link](https://github.com/HumanSignal/labelImg/issues/872#issuecomment-1309017766) to fix the problem.

```console
LabelImg data/KITTI_Syn_DALLE3_Resize predefined_classes.txt
```

In the "output folder" option, select [data/KITTI_Syn_DALLE3_Label/PASCAL_VOC](data/KITTI_Syn_DALLE3_Label/PASCAL_VOC)

Step 5: Generate the labels into KITTI form

### E. Limitations

The image generation process by ChatGPT4.0 + DALLE requires further fine-tuning; when comparing the image pairs in DALLE and in KITTI, one can still feel the difference. However, currently this is not done. 
```console
python xml2kitti.py data/KITTI_Syn_DALLE3_Label/PASCAL_VOC
```

The KITTI label (in .txt) will be stored in the same folder. Then you can copy the .txt labels to the folder [data/KITTI_Syn_DALLE3_Label/KITTI](data/KITTI_Syn_DALLE3_Label/KITTI), and subsequently, to the training dataset [data/data_syn_DALLE3/Kitti/raw/training/label_2](data/data_syn_DALLE3/Kitti/raw/training/label_2)
